<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>2048 – Type Provider Edition</title>
    <meta name="description" content="I'm sure you would have all seen the highly addictive and annoying game 2048 by now (if not, follow the link and have a go now, don't forget to come back here though! ). Fellow F#er @brandewinder wrote a bot that wins the game for you, subsequently turnin...">
    <meta name="author"      content="pezi">
    <meta name="keywords"    content="fsharp, type providers">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/favicon.ico">
    <link rel="canonical" href="http://www.pinksquirrellabs.com/blog\2014\07\03\2048-type-provider-edition/">
    <link rel="next" href="/blog\2014\06\11\some-of-my-favourite-tech-books/">
    <link rel="prev" href="/blog\2014\12\24\the-north-pole-type-provider-escape-from-santa-s-grotto/">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <!-- Feeds -->
    <link rel="alternate" type="application/rss+xml"
          href="/feeds\all.rss.xml" title="RSS Feed">
    <!-- JS -->

  </head>
  <body>
    <!-- A standard Twitter Bootstrap nav bar -->
    <header class="navbar navbar-default navbar-inverse"
            role="banner">
      <div class="container">
        <div class="navbar-header">
          <button type="button"
                  class="navbar-toggle"
                  data-toggle="collapse"
                  data-target=".our-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/index.html" class="navbar-brand">Pink Squirrel Labs</a>
        </div>
        <div class="collapse navbar-collapse our-nav-collapse"
             role="navigation">
          <ul class="nav navbar-nav">

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">All Posts</a></li>

<li><a href="/tags\6502.html">6502</a></li>

<li><a href="/tags\asi64.html">asi64</a></li>

<li><a href="/tags\books.html">books</a></li>

<li><a href="/tags\C.html">C</a></li>

<li><a href="/tags\C64.html">C64</a></li>

<li><a href="/tags\compilers.html">compilers</a></li>

<li><a href="/tags\cracking.html">cracking</a></li>

<li><a href="/tags\D.html">D</a></li>

<li><a href="/tags\digital-logic.html">digital logic</a></li>

<li><a href="/tags\drey.html">drey</a></li>

<li><a href="/tags\electronics.html">electronics</a></li>

<li><a href="/tags\fairylog.html">fairylog</a></li>

<li><a href="/tags\fpga.html">fpga</a></li>

<li><a href="/tags\fsharp.html">fsharp</a></li>

<li><a href="/tags\game-programming.html">game programming</a></li>

<li><a href="/tags\macros.html">macros</a></li>

<li><a href="/tags\programming-languages.html">programming languages</a></li>

<li><a href="/tags\racket.html">racket</a></li>

<li><a href="/tags\raspberry-pi.html">raspberry pi</a></li>

<li><a href="/tags\reverse-engineering.html">reverse engineering</a></li>

<li><a href="/tags\robotics.html">robotics</a></li>

<li><a href="/tags\roguelike.html">roguelike</a></li>

<li><a href="/tags\scurry.html">scurry</a></li>

<li><a href="/tags\sqlprovider.html">sqlprovider</a></li>

<li><a href="/tags\squirrels.html">squirrels</a></li>

<li><a href="/tags\type-providers.html">type providers</a></li>

<li><a href="/tags\xrm.html">xrm</a></li>
              </ul>
            </li>
            <li>
              <a href="/About.html">About</a>
            </li> 
            <li><a href="/feeds\all.rss.xml">RSS</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">

        <!-- Main column -->
        <div id="content" class="col-md-12">





          <article>
  <header>
    <ul class="pager">
    <li class="previous">
      <a href="/blog\2014\12\24\the-north-pole-type-provider-escape-from-santa-s-grotto/">&larr; <em>The North Pole Type Provider: Escape from Santa’s Grotto!</em></a>
    </li>
    <li class="next">
      <a href="/blog\2014\06\11\some-of-my-favourite-tech-books/"><em>Some of my favourite tech books!</em> &rarr;</a>
    </li>
    </ul>
    <h1>2048 – Type Provider Edition</h1>
    <p class='date-and-tags'>
<time datetime="2014-07-03" pubdate="true">2014-07-03</time> :: <span class="tags"><a href="/tags\fsharp.html">fsharp</a>, <a href="/tags\type-providers.html">type providers</a></span></p>
  </header>

<p>I&rsquo;m sure you would have all seen the highly addictive and annoying game <a href="http://gabrielecirulli.github.io/2048/">2048</a> by now (if not, follow the link and have a go now, don&rsquo;t forget to come back here though! ). Fellow F#er <a href="https://twitter.com/brandewinder">@brandewinder</a> wrote a bot that wins the game for you, subsequently turning it into an cool F# dojo. It is <a href="http://www.meetup.com/FSharpLondon/events/185190272/">London&rsquo;s turn for this dojo next Thursday</a>, so I figured before then I would have a go myself and do the obvious thing which is to turn it into a type provider :)</p>

<p>2048 TP Edition is available as part of my <a href="http://pinksquirrellabs.com/post/2014/05/01/BASIC%E2%80%99s-50th-Anniversary-%E2%80%A6-and-more-crazy-F-type-providers!.aspx">type provider abstraction</a> the <a href="https://github.com/pezipink/InteractiveProvider">Interactive Provider</a>. You will want to set your tooltips to a fixed-width font for this to render for you properly. Here is a picture of it in action !</p>

<p><a href="http://www.pinksquirrellabs.com/img/old/image_13.png"><img style="display: inline; border: 0px;" title="image" src="../../../../../img/old/image_thumb_13.png" alt="image" width="902" height="305" border="0" /></a></p>
<!-- more-->

<h2>2048 Implementation</h2>

<p>I will start by saying that I have not looked at any other implementations of either the game or any automated bots, so if this is terrible then please forgive me. I had also not played the game at all until recently and as such the rules implemented here are from my brief analysis of playing it. There might be some subtleties I have overlooked.</p>

<p>I first implemented this using arrays as it seemed like a natural fit for the 4 x 4 board, but although I got it to work, it was horrible and instead I replaced it with this much more functional version.</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">type</span><span class="w"> </span><span class="nc">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">int</span><span class="o">,</span><span class="w"> </span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span>
<span class="k">type</span><span class="w"> </span><span class="nc">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Up</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Down</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Right</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>That covers the entire domain :) Each location of the grid is stored in the map along with the value, if one exists.</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">let</span><span class="w"> </span><span class="nv">shift</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Up</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Down</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Right</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span><span class="n">y</span><span class="o">)</span>

<span class="k">let</span><span class="w"> </span><span class="nv">moves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Up</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="o">[</span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">       </span><span class="k">yield</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">]</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Down</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="o">[</span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">3</span><span class="o">..-</span><span class="mi">1</span><span class="o">..</span><span class="mi">0</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">       </span><span class="k">yield</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">]</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="o">[</span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">       </span><span class="k">yield</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">]</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Right</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="o">[</span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">3</span><span class="o">..-</span><span class="mi">1</span><span class="o">..</span><span class="mi">0</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">       </span><span class="k">yield</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">]</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>A couple of utility functions. The first is pretty obvious, the second returns a list of tuples indicating the order that the cells should be processed. The order is very important for a number of reasons as will become clear.</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">px</span><span class="o">,</span><span class="n">py</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="o">_</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">_,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="o">,</span><span class="w"> </span><span class="o">_</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">_,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">px</span><span class="o">,</span><span class="n">py</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">containsKey</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">px</span><span class="o">,</span><span class="n">py</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">(</span><span class="n">shift</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="n">direction</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>This function takes a location and attempts to move it in the specified direction until either it goes out of bounds, or it finds the location is already taken in the map. In either case, it returns the last good position that can be moved to.</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">let</span><span class="w"> </span><span class="nv">replace</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="nv">move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span>
<span class="w">  </span><span class="o">(</span><span class="n">data</span><span class="o">,</span><span class="n">inputs</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">||&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">fold</span><span class="o">(</span><span class="k">fun</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">(</span><span class="n">shift</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">direction</span><span class="o">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">newpos</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">newpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">newpos</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">.[</span><span class="n">p</span><span class="o">]</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">remove</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">add</span><span class="w"> </span><span class="n">newpos</span><span class="w"> </span><span class="n">v</span><span class="o">)</span>

<span class="k">let</span><span class="w"> </span><span class="nv">compress</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="n">direction</span><span class="w"> </span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">moves</span><span class="w"> </span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span><span class="o">(</span><span class="k">fun</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">containsKey</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">data</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>These functions effectively &ldquo;compress&rdquo; the map in a specified direction. What this means is that if we are going Up, it will start from the top row, and moving downwards it will move each cell up as far as it can go, resulting in a new compressed map. You can think of this much like defragging memory, but with a direction bias. It&rsquo;s like applying gravity from different directions :)</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">let</span><span class="w"> </span><span class="nv">merge</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="nv">moves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">moves</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">pairwise</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">toList</span><span class="w"> </span>
<span class="w">  </span><span class="o">(</span><span class="n">data</span><span class="o">,</span><span class="n">moves</span><span class="o">)</span><span class="w"> </span>
<span class="w">  </span><span class="o">||&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">fold</span><span class="o">(</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">((</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">),</span><span class="w"> </span><span class="o">(</span><span class="n">x&#39;</span><span class="o">,</span><span class="n">y&#39;</span><span class="o">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">tryFind</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="n">data</span><span class="o">,</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">tryFind</span><span class="o">(</span><span class="n">x&#39;</span><span class="o">,</span><span class="n">y&#39;</span><span class="o">)</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">first</span><span class="o">,</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span>
<span class="w">      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">remove</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span>
<span class="w">      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">remove</span><span class="w"> </span><span class="o">(</span><span class="n">x&#39;</span><span class="o">,</span><span class="n">y&#39;</span><span class="o">)</span><span class="w"> </span>
<span class="w">      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">add</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">first</span><span class="o">*</span><span class="mi">2</span><span class="o">)</span><span class="w"> </span>
<span class="w">    </span><span class="o">|_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="o">)</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>This one is a little more fun :) The idea of the merge function is to, based on the direction, merge any pair cells that are touching and have the same value, replacing them with one cell (based on the &ldquo;gravity&rdquo; direction) that has double the value. This code uses pairwise to serve up each pair of locations &ndash; the order that the cells are generated from the moves function is critical here</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">let</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">compress</span><span class="w"> </span><span class="n">direction</span><span class="o">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">merge</span><span class="w"> </span><span class="n">direction</span><span class="o">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">(</span><span class="n">compress</span><span class="w"> </span><span class="n">direction</span><span class="o">)</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Using function composition, I can now say that one step of the simulation consists of compressing the map in a certain direction, merging the resulting cells together where appropriate, and then compressing again to fill in any blanks that appeared from the merge step. I think this is pretty awesome :)</p>

<h2>Type Provider</h2>

<p>As mentioned before, this uses my Interactive Provider so there is no gnarly provided types code. Instead, I have a very simple state that gets passed back and forth</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">type</span><span class="w"> </span><span class="n">``2048State``</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">NewGame</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">GameOn</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">int</span><span class="o">*</span><span class="n">int</span><span class="o">,</span><span class="w"> </span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">GameOver</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span>
<span class="w">  </span><span class="k">interface</span><span class="w"> </span><span class="n">IInteractiveState</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">    </span><span class="k">member</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="nf">DisplayOptions</span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="kt">string</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">obj</span><span class="o">)</span><span class="w"> </span><span class="kt">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">      </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">NewGame</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="s">"Begin Game"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">""</span><span class="o">]</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">GameOn</span><span class="o">(</span><span class="n">data</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="s">"# Show Grid"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">"show"</span><span class="o">;</span><span class="s">"Up"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">"up"</span><span class="o">;</span><span class="s">"Down"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">"down"</span><span class="o">;</span><span class="s">"Left"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">"left"</span><span class="o">;</span><span class="s">"Right"</span><span class="o">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="s">"right"</span><span class="o">;]</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">GameOver</span><span class="o">(</span><span class="k">true</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">GameOver</span><span class="o">(</span><span class="k">false</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span>
<span class="w">    </span><span class="k">member</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="nf">DisplayText</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// omit drawing code for brevity </span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Very simple .. at the start it shows &ldquo;Begin Game&rdquo; and from then on displays the directional choices as properties along with a &ldquo;# Show Grid&rdquo; property that shows the current state of the grid.</p>

<div class="brush: fsharp">
 <div class="highlight">
  <table class="highlighttable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="k">type</span><span class="w"> </span><span class="n">``2048``</span><span class="bp">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="k">interface</span><span class="w"> </span><span class="n">IInteractiveServer</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">    </span><span class="k">member</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="nf">NewState</span><span class="o">:</span><span class="w"> </span><span class="n">IInteractiveState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewGame</span><span class="w"> </span><span class="o">:&gt;</span><span class="w"> </span><span class="n">IInteractiveState</span><span class="w"> </span>
<span class="w">    </span><span class="k">member</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="nf">ProcessResponse</span><span class="o">(</span><span class="n">state</span><span class="o">:</span><span class="w"> </span><span class="n">IInteractiveState</span><span class="o">,</span><span class="w"> </span><span class="n">response</span><span class="o">:</span><span class="w"> </span><span class="kt">obj</span><span class="o">):</span><span class="w"> </span><span class="n">IInteractiveState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">      </span><span class="k">let</span><span class="w"> </span><span class="o">(|</span><span class="n">Win</span><span class="o">|</span><span class="n">Lose</span><span class="o">|</span><span class="n">Continue</span><span class="o">|)</span><span class="w"> </span><span class="o">(</span><span class="n">data</span><span class="o">:</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">int</span><span class="o">*</span><span class="n">int</span><span class="o">,</span><span class="n">int</span><span class="o">&gt;)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="o">((</span><span class="k">true</span><span class="o">,</span><span class="mi">0</span><span class="o">),[</span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">                   </span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">                   </span><span class="k">yield</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">])</span><span class="w"> </span>
<span class="w">        </span><span class="o">||&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">fold</span><span class="o">(</span><span class="k">fun</span><span class="w"> </span><span class="o">(</span><span class="n">b</span><span class="o">,</span><span class="n">highest</span><span class="o">)</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">tryFind</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">highest</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">(</span><span class="n">b</span><span class="o">,</span><span class="n">v</span><span class="o">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">(</span><span class="n">b</span><span class="o">,</span><span class="n">highest</span><span class="o">)</span><span class="w"> </span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">(</span><span class="k">false</span><span class="o">,</span><span class="n">highest</span><span class="o">))</span><span class="w"> </span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="o">(_,</span><span class="w"> </span><span class="mi">2048</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Win</span><span class="w"> </span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="k">true</span><span class="o">,</span><span class="w"> </span><span class="o">_)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Lose</span><span class="w"> </span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Continue</span><span class="w"> </span><span class="n">data</span>

<span class="w">      </span><span class="k">match</span><span class="w"> </span><span class="o">(</span><span class="n">state</span><span class="o">:?&gt;</span><span class="n">``2048State``</span><span class="o">),</span><span class="w"> </span><span class="o">(</span><span class="n">response</span><span class="w"> </span><span class="o">:?&gt;</span><span class="w"> </span><span class="n">String</span><span class="o">).</span><span class="n">ValueOption</span><span class="bp">()</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">NewGame</span><span class="o">,</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">        </span><span class="k">let</span><span class="w"> </span><span class="nv">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnd</span><span class="o">.</span><span class="n">Next</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span><span class="w"> </span><span class="n">rnd</span><span class="o">.</span><span class="n">Next</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">)</span><span class="w"> </span>
<span class="w">        </span><span class="n">GameOn</span><span class="o">(</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">ofList</span><span class="o">[(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">),</span><span class="mi">2</span><span class="o">])</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">GameOn</span><span class="o">(</span><span class="n">data</span><span class="o">),</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="s">"show"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GameOn</span><span class="o">(</span><span class="n">data</span><span class="o">)</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">GameOn</span><span class="o">(</span><span class="n">data</span><span class="o">),</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">        </span><span class="k">let</span><span class="w"> </span><span class="nv">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">          </span><span class="k">match</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="s">"left"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="s">"right"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Right</span><span class="w"> </span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="s">"up"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Up</span><span class="w"> </span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="s">"down"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Down</span><span class="w"> </span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">failwith</span><span class="w"> </span><span class="s">""</span><span class="w"> </span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Win</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GameOver</span><span class="w"> </span><span class="k">true</span><span class="w"> </span>
<span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Lose</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GameOver</span><span class="w"> </span><span class="k">false</span><span class="w"> </span>
<span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Continue</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">          </span><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">aux</span><span class="w"> </span><span class="bp">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">            </span><span class="k">let</span><span class="w"> </span><span class="nv">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnd</span><span class="o">.</span><span class="n">Next</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span><span class="w"> </span><span class="n">rnd</span><span class="o">.</span><span class="n">Next</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">)</span><span class="w"> </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nn">Map</span><span class="p">.</span><span class="n">containsKey</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">aux</span><span class="bp">()</span><span class="w"> </span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="w"> </span>
<span class="w">        </span><span class="n">GameOn</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="n">Add</span><span class="o">(</span><span class="n">aux</span><span class="bp">()</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span><span class="w"> </span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">_,</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">failwith</span><span class="w"> </span><span class="s">""</span><span class="w"> </span>
<span class="w">      </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:&gt;</span><span class="w"> </span><span class="n">IInteractiveState</span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>There is really not a lot to this. The active pattern at the top cycles through all the possible grid states, collecting the highest cells and whether or not all the cells are populated. With this information it can return if the game has been won, lost, or should continue.</p>

<p>When the game is running, it simply looks at the direction that was selected, and pattern matches on the results of calling the composed step function using the active pattern above. Assuming the game is still running, it finds a random location to put a new 2 in, and returns the new data map.</p>

<p></p>

<h2>Conclusion</h2>

<p>Now you can really spend time in Visual Studio playing games instead of working, because this is a lot more fun than minesweeper! 2048 Type Provider Edition for the win!</p>
  <footer>
    <ul class="pager">
    <li class="previous">
      <a href="/blog\2014\12\24\the-north-pole-type-provider-escape-from-santa-s-grotto/">&larr; <em>The North Pole Type Provider: Escape from Santa’s Grotto!</em></a>
    </li>
    <li class="next">
      <a href="/blog\2014\06\11\some-of-my-favourite-tech-books/"><em>Some of my favourite tech books!</em> &rarr;</a>
    </li>
    </ul>

  </footer>
</article>
        </div>
      </div>
      <footer>
        <hr />

      </footer>
    </div>
    <!-- </body> JS -->
    <script type="text/javascript" src="//code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  </body>
</html>